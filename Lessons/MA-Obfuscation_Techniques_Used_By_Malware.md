# Obfuscation techniques used by malware

## What is obfuscation?

Most malware are created using one or more obfuscation techniques, ways of
constructing them that make it more difficult to detect. If a virus is
hard to detect, it is likely to spread more widely.

The following are commonly used obfuscation techniques.

## Encoding Obfuscation Techniques

### Base64 Encoding

Base64 encoding has been used for a long time to transfer binary data
(machine code) over a system that only handles text.  As the name suggests,
its encoding alphabet contains 64 characters, with the equal sign (=) used
as a padding character.  The alphabet contains the characters A-Z, a-z, 0-9,
\+ and /.  Below is an example of some encoded text representing the string
pointing to the svchost.exe file, used by Windows to host services.

```bat
sansforensics@siftworkstation -> ~ 
$ echo -n "C:\Windows\system32\svchost.exe" | base64
QzpcV2luZG93c1xzeXN0ZW0zMlxzdmNob3N0LmV4ZQ==
sansforensics@siftworkstation -> ~ 
```

Base64 is commonly used in malware to disguise text strings. While the
encoded output is completely unreadable, base64 encoding is easier to identify
than a lot of encoding schemes, usually because of its padding character.
There are a lot of tools that can perform base64 encode/decode functions,
both online and via downloaded programs.

### XOR operation

The exclusive or operation (represented as XOR) is probably the most commonly used
method of obfuscation.  This is because it is very easy to implement and easily hides
your data from untrained eyes.  Consider the following highlighted data.

Obfuscated data is unreadable in its current form. In its current form, the data is
unreadable.  But when we apply an XOR value of 0x55, we see something else entirely.

An XOR operation using 0x55 reveals a malicious URL. Now we have our malicious URL.
Looks like this malware contacts “http://tator1157.hostgator.com” to retrieve the
file “bot.exe”.

This form of obfuscation is typically very easy to defeat. Even if you
don’t have the XOR key, programs exist to manually cycle through every possible
single-byte XOR value in search of a particular string.

Because malware authors know programs like these exist, they implement tricks of
their own to avoid detection.  One thing they might do is a two-cycle approach,
performing an XOR against data with a particular value and then making a second
pass with another value.  A separate technique (although equally effective) commonly
used is to increment the XOR value in a loop.  Using the previous example, we could
XOR the letter ‘h’ with 0x55, then the letter ‘t’ with 0x56, and so on. This would
also defeat common XOR detection programs.

### Hexadecimal encoding

Hexadecimal is a positional notation system with a base of 16. It uses sixteen
distinct symbols, most often the symbols 0-­‐9 to represent the values zero to nine,
and A, B, C, D, E, F (or alternatively a-­‐f) to represent values ten to fifteen. 

Hexadecimal encoding can be seen to hide malicious scripts. Malware authors have
been relying on those to make identification of malicious code much more difficult
for both human eyes and scanners. Tech support scammers have been no stranger to
leveraging obfuscation within their browser locker templates. For instance, by
using this hexadecimal encoding, the crooks can mask a fake warning message
from prying eyes.

## Programmatic Obfuscation Techniques

### Replace method

### Array Trickery

### No alnum

### Eval function

### Escape/unescape Function

### Malformed Syntax

### Random Variable Naming

### Environment / User Variables

## Encryption Obfuscation Techniques


# References

https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-83.pdf
https://www.sans.org/reading-room/whitepapers/engineering/pdf-obfuscation-primer-34005
https://blog.malwarebytes.com/threat-analysis/2013/03/obfuscation-malwares-best-friend/
https://blog.malwarebytes.com/threat-analysis/2013/05/nowhere-to-hide-three-methods-of-xor-obfuscation
https://blog.malwarebytes.com/threat-analysis/2018/11/browlock-flies-under-the-radar-with-complete-obfuscation//
